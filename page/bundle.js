(()=>{"use strict";(()=>{const e="&#8679; Shift",t=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Emoji3","Emoji1","Emoji2"],s=["Space","Tab","Backspace","Delete","Enter"],i={line1:["Backquote:key","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace:Func:2:<big>‚üµ</big>&#8239;Backspace","Delete:Func:1:Del"],line2:["Tab:Func:1.5:Tab&#8239;<big>&#11120;</big>","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash:key:1.5","Emoji1"],line3:["CapsLock:Func:1.75:CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter:Func:2.25:Enter&#8239;<big>&#8629;</big>","Emoji2"],line4:[`ShiftLeft:Func:2.25:${e}`,"KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma:key","Period:key","Slash:key",`ShiftRight:Func:1.75:${e}`,"ArrowUp:Arrow:1:&#9650;:‚¨ÜÔ∏è","Emoji3"],line5:["ControlLeft:Func:1.5:Ctrl",'MetaLeft:Func:1:<span class="material-symbols-outlined">\nkeyboard_command_key\n</span>',"AltLeft:Func:1:Alt","Space:Space:7.5:","AltRight:Func:1:Alt","ControlRight:Func:1:Ctrl","ArrowLeft:Arrow:1:&#9668;:‚¨ÖÔ∏è","ArrowDown:Arrow:1:&#9660;:‚¨áÔ∏è","ArrowRight:Arrow:1:&#9654;:‚û°Ô∏è"]};class n{constructor(e,t="key",s=1,i="",n=""){this.element=document.createElement("div"),this.element.classList.add("btn"),this.element.classList.add(`btn--${t}`),"letters"===e&&this.element.classList.add("btn--magic"),this.element.id=e,this.element.innerHTML=i,n&&(this.element.dataset.printValue=n||i),s>1&&(this.element.style.flexGrow=s),this.code=e,this.key=i,this.label=i,this.type=t,this.isPressed=!1}changeLabel(e){this.element.innerHTML=e,this.label=e}addClass(e){this.element.classList.add(e)}removeClass(e){this.element.classList.remove(e)}}const a='  <div class="container">\n  <div class="components">\n    <div class="form">\n    </div>\n    <ul class="info">–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ Windows.\n      <li>–ß—Ç–æ–±—ã <a href="#" class="link link--switchlang">–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —è–∑—ã–∫</a> –∫–æ–º–±–∏–Ω–∞—Ü–∏—è: –ª–µ–≤—ãe shift + alt;\n      –∏–ª–∏ –∑–∞–∂–∞—Ç—å shift:  –ø–∫–º –∏–ª–∏ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.</li>\n      <li>–û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å ctrl –∏ alt  –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.</li>\n      <li>–ö–ª–∞–≤–∏—à–∏ Ctrl Shift Alt –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –º—ã—à–∫–æ–π –∑–∞–∂–∏–º–∞—é—Ç—Å—è, –ø—Ä–∏ –≤—Ç–æ—Ä–æ–º - –æ—Ç–∂–∏–º–∞—é—Ç—Å—è:\n       —Ç–∞–∫ –∏ –∑–∞–¥—É–º–∞–Ω–æ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —ç–º—É–ª—è—Ü–∏–∏ –∫–æ–±–∏–Ω–∞—Ü–∏–π –∫–ª–∞–≤–∏—à —Ç–æ–ª—å–∫–æ —Å —ç–∫—Ä–∞–Ω–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</li>\n      <li>–ù–∞–∂–∞—Ç–∏—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è</li>\n      </ul>\n    <footer class="footer ">\n        <ul class="footer-list">\n          <li class="footer-item footer-text">¬© 2023</li>\n          <li>\n            <a class="footer-item link" href="https://github.com/LidaChk/virtual-keyboard">\n              <img class="footer-svg" src="./assets/svg/GitHub-Mark.svg" alt="GitHub Icon" width="30">\n            </a>\n          </li>\n          <li>\n            <a class="footer-item link" href="https://rs.school/js/">\n              <img class="footer-svg" src="./assets/svg/rs_school_js.svg" alt="Rsschool Icon" width="73">\n            </a>\n          </li>\n          <li>\n          <a class="footer-item link" href="https://rosely.hellotham.com/">\n          <img class="footer-svg footer-svg--rose" src="./assets/svg/rosely.svg" alt="Rosely" width="73">\n        </a>\n        </li>\n        </ul>\n  </div>\n</div>',l=[{lang:"Eng",shifted:!1,layout:{Backquote:"`",Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0",Minus:"-",Equal:"=",KeyQ:"q",KeyW:"w",KeyE:"e",KeyR:"r",KeyT:"t",KeyY:"y",KeyU:"u",KeyI:"i",KeyO:"o",KeyP:"p",BracketLeft:"[",BracketRight:"]",Backslash:"\\",KeyA:"a",KeyS:"s",KeyD:"d",KeyF:"f",KeyG:"g",KeyH:"h",KeyJ:"j",KeyK:"k",KeyL:"l",Semicolon:";",Quote:"'",KeyZ:"z",KeyX:"x",KeyC:"c",KeyV:"v",KeyB:"b",KeyN:"n",KeyM:"m",Comma:",",Period:".",Slash:"/",ArrowUp:"‚¨ÜÔ∏è",ArrowDown:"‚¨áÔ∏è",ArrowRight:"‚û°Ô∏è",ArrowLeft:"‚¨ÖÔ∏è",Emoji1:"ü¶Ñ",Emoji2:"üíñ",Emoji3:"‚ú®"}},{lang:"Eng",shifted:!0,layout:{Backquote:"~",Digit1:"!",Digit2:"@",Digit3:"#",Digit4:"$",Digit5:"%",Digit6:"^",Digit7:"&",Digit8:"*",Digit9:"(",Digit0:")",Minus:"_",Equal:"+",KeyQ:"Q",KeyW:"W",KeyE:"E",KeyR:"R",KeyT:"T",KeyY:"Y",KeyU:"U",KeyI:"I",KeyO:"O",KeyP:"P",BracketLeft:"{",BracketRight:"}",Backslash:"|",KeyA:"A",KeyS:"S",KeyD:"D",KeyF:"F",KeyG:"G",KeyH:"H",KeyJ:"J",KeyK:"K",KeyL:"L",Semicolon:":",Quote:'"',KeyZ:"Z",KeyX:"X",KeyC:"C",KeyV:"V",KeyB:"B",KeyN:"N",KeyM:"M",Comma:"<",Period:">",Slash:"?",ArrowUp:"‚¨ÜÔ∏è",ArrowDown:"‚¨áÔ∏è",ArrowRight:"‚û°Ô∏è",ArrowLeft:"‚¨ÖÔ∏è",Emoji1:"üêî",Emoji2:"üç™",Emoji3:"üòª"}},{lang:"Rus",shifted:!1,layout:{Backquote:"—ë",Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0",Minus:"-",Equal:"=",KeyQ:"–π",KeyW:"—Ü",KeyE:"—É",KeyR:"–∫",KeyT:"–µ",KeyY:"–Ω",KeyU:"–≥",KeyI:"—à",KeyO:"—â",KeyP:"–∑",BracketLeft:"—Ö",BracketRight:"—ä",Backslash:"&#92;",KeyA:"—Ñ",KeyS:"—ã",KeyD:"–≤",KeyF:"–∞",KeyG:"–ø",KeyH:"—Ä",KeyJ:"–æ",KeyK:"–ª",KeyL:"–¥",Semicolon:"–∂",Quote:"—ç",KeyZ:"—è",KeyX:"—á",KeyC:"—Å",KeyV:"–º",KeyB:"–∏",KeyN:"—Ç",KeyM:"—å",Comma:"–±",Period:"—é",Slash:".",ArrowUp:"‚¨ÜÔ∏è",ArrowDown:"‚¨áÔ∏è",ArrowRight:"‚û°Ô∏è",ArrowLeft:"‚¨ÖÔ∏è",Emoji1:"üêù",Emoji2:"üçÑ",Emoji3:"üíé"}},{lang:"Rus",shifted:!0,layout:{Backquote:"–Å",Digit1:"!",Digit2:'"',Digit3:"‚Ññ",Digit4:";",Digit5:"%",Digit6:":",Digit7:"?",Digit8:"*",Digit9:"(",Digit0:")",Minus:"_",Equal:"+",KeyQ:"–ô",KeyW:"–¶",KeyE:"–£",KeyR:"–ö",KeyT:"–ï",KeyY:"–ù",KeyU:"–ì",KeyI:"–®",KeyO:"–©",KeyP:"–ó",BracketLeft:"–•",BracketRight:"–™",Backslash:"/",KeyA:"–§",KeyS:"–´",KeyD:"–í",KeyF:"–ê",KeyG:"–ü",KeyH:"–†",KeyJ:"–û",KeyK:"–õ",KeyL:"–î",Semicolon:"–ñ",Quote:"–≠",KeyZ:"–Ø",KeyX:"–ß",KeyC:"–°",KeyV:"–ú",KeyB:"–ò",KeyN:"–¢",KeyM:"–¨",Comma:"–ë",Period:"–Æ",Slash:",",ArrowUp:"‚¨ÜÔ∏è",ArrowDown:"‚¨áÔ∏è",ArrowRight:"‚û°Ô∏è",ArrowLeft:"‚¨ÖÔ∏è",Emoji1:"üöÄ",Emoji2:"üê≤",Emoji3:"üî•"}}];class h{constructor(){this.cols=80,this.rows=4;const e=document.createElement("textarea");e.classList.add("form__input"),e.setAttribute("rows",this.rows),e.setAttribute("cols",this.cols),e.setAttribute("placeholder","Type anything..."),e.setAttribute("autofocus","true"),e.setAttribute("tabindex","-1"),e.setAttribute("spellcheck","false"),this.element=e,document.querySelector(".form").appendChild(this.element)}addToKeyboard(){document.querySelector(".form").appendChild(this.element)}updateValueWithKey(e,t,s,i){this.element.focus();const{value:n}=this.element,a=this.element.selectionStart,l=this.element.selectionEnd;this.element.value=`${n.slice(0,a)}${i}${n.slice(l)}`,this.element.selectionEnd=a+i.length}updateValueWithMnpKey(e){this.element.focus();const{value:t}=this.element,s=this.element.selectionStart,i=this.element.selectionEnd;switch(e){case"Space":this.element.value=`${t.slice(0,s)} ${t.slice(i)}`,this.element.selectionEnd=s+1;break;case"Tab":this.element.value=`${t.slice(0,s)}\t${t.slice(i)}`,this.element.selectionEnd=s+1;break;case"Backspace":case"Delete":if(i>s)this.element.value=`${t.slice(0,s)}${t.slice(i)}`,this.element.selectionEnd=s;else if("Backspace"===e){const e=t.codePointAt(i-1)>55e3?2:1;this.element.value=`${t.slice(0,s-e)}${t.slice(i)}`,this.element.selectionEnd=s-e}else if("Delete"===e){const e=t.codePointAt(i)>55e3?2:1;this.element.value=`${t.slice(0,s)}${t.slice(i+e)}`,this.element.selectionEnd=s}break;case"Enter":this.element.value=`${t.slice(0,s)}\n${t.slice(i)}`,this.element.selectionEnd=s+1}}getCurrentRow(){const e=this.element.selectionEnd;return this.element.value.slice(0,e).split("\n").redusce(((e,t)=>t+(""===e?0:Math.floor(e.length/this.cols))))}getMaxRow(){return this.element.split("\n").redusce(((e,t)=>t+(""===e?0:Math.floor(e.length/this.cols))))}}const o=new class{constructor(){this.model=new class{constructor(){this.lsCurrentKeys="cybervapor-vkb-currentKeys",this.lsLang="cybervapor-vkb-lang",this.currentKeys=new Set,this.needToRelease=new Set,this.lang=this.getLangFromLocalStorage()||"Eng",this.langs=["Eng","Rus"],this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.capsKey=!1,this.shifted=!1,this.notFuncKeys=new Set(t),this.manipulatingKeys=new Set(s),this.#e()}pressKey(e){switch(e){case"CapsLock":this.currentKeys.has("CapsLock")&&this.needToRelease.add("CapsLock");break;case"ShiftLeft":case"ShiftRight":this.shiftKey&&(this.needToRelease.add("ShiftLeft"),this.needToRelease.add("ShiftRight"));break;case"AltLeft":case"AltRight":this.altKey&&(this.needToRelease.add("AltLeft"),this.needToRelease.add("AltRight"));break;case"ControlLeft":case"ControlRight":this.ctrlKey&&(this.needToRelease.add("ControlLeft"),this.needToRelease.add("ControlRight"))}this.currentKeys.add(e),this.updateModifierState()}releaseKey(e,t){switch(e){case"CapsLock":break;case"ShiftLeft":case"ShiftRight":case"AltLeft":case"AltRight":this.isShifhtAltCombo()?(this.currentKeys.delete("AltLeft"),this.currentKeys.delete("AltRight"),this.currentKeys.delete("ShiftLeft"),this.currentKeys.delete("ShiftRight")):this.isShiftKeyCombo()?(this.currentKeys.delete("ShiftLeft"),this.currentKeys.delete("ShiftRight")):this.isAltKeyCombo()&&(this.currentKeys.delete("AltLeft"),this.currentKeys.delete("AltRight"));break;case"ControlLeft":case"ControlRight":this.isCtrlKeyCombo()&&(this.currentKeys.delete("ControlLeft"),this.currentKeys.delete("ControlRight"));break;default:this.currentKeys.delete(e)}"physKey"===t&&"CapsLock"!==e&&(this.currentKeys.delete(e),this.needToRelease.delete(e),e.endsWith("Left")&&(this.currentKeys.delete(e.replace("Left","Right")),this.needToRelease.delete(e.replace("Left","Right"))),e.endsWith("Right")&&(this.currentKeys.delete(e.replace("Right","Left")),this.needToRelease.delete(e.replace("Right","Left")))),[...this.needToRelease].forEach((e=>{this.currentKeys.delete(e),this.needToRelease.delete(e)})),this.updateModifierState()}updateModifierState(){this.shiftKey=this.currentKeys.has("ShiftLeft")||this.currentKeys.has("ShiftRight"),this.ctrlKey=this.currentKeys.has("ControlLeft")||this.currentKeys.has("ControlRight"),this.altKey=this.currentKeys.has("AltLeft")||this.currentKeys.has("AltRight"),this.capsKey=this.currentKeys.has("CapsLock"),this.shifted=(this.capsKey||this.shiftKey)&&!(this.capsKey&&this.shiftKey)}isShiftKeyCombo(){return[...this.currentKeys].some((e=>e.startsWith("Key")))&&(this.currentKeys.has("ShiftLeft")||this.currentKeys.has("ShiftRight"))}isCtrlKeyCombo(){return[...this.currentKeys].some((e=>e.startsWith("Key")))&&(this.currentKeys.has("ControlLeft")||this.currentKeys.has("ControlRight"))}isAltKeyCombo(){return[...this.currentKeys].some((e=>e.startsWith("Key")))&&(this.currentKeys.has("AltLeft")||this.currentKeys.has("AltRight"))}isShifhtAltCombo(){return(this.currentKeys.has("ShiftLeft")||this.currentKeys.has("ShiftRight"))&&(this.currentKeys.has("AltLeft")||this.currentKeys.has("AltRight"))}switchLang(){this.lang=this.langs.at((this.langs.findIndex((e=>e===this.lang))||0)-1),this.#e()}getLangFromLocalStorage(){return localStorage.getItem(this.lsLang)}#e(){localStorage.setItem(this.lsLang,this.lang)}isShifted(){return this.currentKeys.has("ShiftLeft")||this.currentKeys.has("ShiftRight")}checkStackedKeys(){[...this.currentKeys].forEach((e=>{this.manipulatingKeys.has(e)&&this.currentKeys.delete(e),this.notFuncKeys.has(e)&&this.currentKeys.delete(e),e.includes("Meta")&&this.currentKeys.delete(e)}))}},this.view=new class{constructor(){this.element=document.createElement("div"),this.element.classList.add("keyborad-container"),this.btns={},this.element.dataset.lang="",this.element.dataset.shifted="",Object.keys(i).forEach((e=>{const t=document.createElement("div");t.classList.add("line-container"),t.classList.add(`keyboard-${e}`),i[e].forEach((e=>{const s=new n(...e.split(":"));t.appendChild(s.element),this.btns[s.code]=s})),this.element.appendChild(t)})),document.body.innerHTML=a,document.querySelector(".form").after(this.element)}init(){this.state="initialized"}syncLangShift(e,t,s){if(this.element.dataset.lang!==e||this.element.dataset.shiftKey!==t.toString()||this.element.dataset.capsKey!==s.toString()){this.element.dataset.shifted=t.toString(),this.element.dataset.capsKey=s.toString(),this.element.dataset.lang=e;const i=l.find((s=>s.lang===e&&s.shifted===t)).layout;Object.keys(this.btns).filter((e=>"key"===this.btns[e].type)).forEach((e=>{s&&t&&"Key"===e.slice(0,3)?this.btns[e].changeLabel(i[e].toLowerCase()):s&&!t&&"Key"===e.slice(0,3)?this.btns[e].changeLabel(i[e].toUpperCase()):this.btns[e].changeLabel(i[e])}))}}activateBtns(e){e.forEach((e=>{this.btns[e]?.addClass("btn--active")}))}deactivateBtns(e){Object.keys(this.btns)?.forEach((t=>{e.has(t)||this.btns[t].removeClass("btn--active")}))}},this.notFuncKeys=new Set(t),this.manipulatingKeys=new Set(s)}init(){this.view.syncLangShift(this.model.lang,this.model.shiftKey,this.model.capsKey)}handleKeyPress(e,t,s){this.model.pressKey(e),(t||s)&&this.sendEventToTextarea(e,t,s),this.view.activateBtns(this.model.currentKeys),this.view.syncLangShift(this.model.lang,this.model.shiftKey,this.model.capsKey)}handleKeyRelease(e,t){this.model.isShifhtAltCombo()&&this.switchLang(),this.model.releaseKey(e,t),this.view.deactivateBtns(this.model.currentKeys),this.view.syncLangShift(this.model.lang,this.model.shiftKey,this.model.capsKey)}checkStackedKeys(){this.model.checkStackedKeys(),this.view.deactivateBtns(this.model.currentKeys),this.view.syncLangShift(this.model.lang,this.model.shiftKey,this.model.capsKey)}addEvents(){const e=this.view.element;e.addEventListener("mousedown",(e=>{if(0===e.button){const t=e.target.closest(".btn");clearTimeout(this.checkTimeout),t&&(this.handleKeyPress(t.id,this.notFuncKeys.has(t.id),this.manipulatingKeys.has(t.id)),this.checkTimeout=setTimeout(this.checkStackedKeys.bind(this))),e.preventDefault()}})),e.addEventListener("mouseup",(e=>{if(0===e.button){const t=e.target.closest(".btn");t&&(this.handleKeyRelease(t.id,"mouse"),e.preventDefault())}})),document.addEventListener("keydown",(e=>{e.code.includes("Numpad")?e.preventDefault():void 0!==this.view.btns[e.code]&&(this.handleKeyPress(e.code,this.notFuncKeys.has(e.code),this.manipulatingKeys.has(e.code)),e.preventDefault())})),document.addEventListener("keyup",(e=>{e.code.includes("Numpad")||this.handleKeyRelease(e.code,"physKey"),e.preventDefault()})),document.querySelector(".link--switchlang").addEventListener("click",(()=>{this.switchLang()})),e.addEventListener("contextmenu",(e=>{const t=e.target.closest(".btn");t&&t.id.includes("Shift")&&this.switchLang()}))}switchLang(){this.model.switchLang(),this.view.syncLangShift(this.model.lang,this.model.shiftKey,this.model.capsKey)}sendEventToTextarea(e,t,s){this.textarea||(this.textarea=document.querySelector("textarea.form__input"));const i=new class{constructor(e=!1,t=!1,s=!1,i=!1,n=!1,a="",l="Eng",h=!1,o=!1,r=""){this.customEvent=new CustomEvent("virtualKeyboardEvent",{detail:{altKey:e,ctrlKey:t,metaKey:s,shiftKey:i,shifted:n,key:a,lang:l,isKey:h,isMnpKey:o,value:r},bubbles:!1,cancelable:!0,composed:!1})}}(this.model.altKey,this.model.ctrlKey,!1,this.model.shiftKey,this.model.shifted,e,this.model.lang,t,s,this.view.btns[e]?.element.dataset.printValue||this.view.btns[e]?.element.innerHTML);this.textarea.dispatchEvent(i.customEvent)}},r=new class{constructor(){this.view=new h}init(){this.view.addToKeyboard()}addEvents(){this.view.element.addEventListener("virtualKeyboardEvent",(e=>{e.detail.isKey&&this.view.updateValueWithKey(e.detail.key,e.detail.shifted,e.detail.lang,e.detail.value),e.detail.isMnpKey&&this.view.updateValueWithMnpKey(e.detail.key)}))}};o.init(),o.addEvents(),r.init(),r.addEvents()})()})();